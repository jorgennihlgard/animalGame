<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/stylesheet" href="/stylesheet.css">
    <script type="text/javascript" src="script.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>
   <title>Djurspelet</title>

   <style>
   h1{text-align: center}
   button{margin:20px;}
   submitAnswer{display: block;}
   </style>
</head>
    <body>

        
       
        <h1>Djurspelet pau svenska</h1>
        
       
        <p id="stringObject" style="display: none"><%= JSON.stringify(jsonData) %></p>
        <div class="container">
            <div class="row">
            <div class="col-md-6 offset-md-2">    
                <button id="yesBtn" name="answer" value ="Yes">Ja!</button>
                <button id="noBtn" name="answer" value="No">Nej!</button>
                <input type="submit" style="visibility: hidden;" id="submitAnswer" value="Svara på fråga">
                <input type="submit" id="refresh" style="background-color:green; visibility: hidden;" onclick="RefreshPage()" value="Börja om spel">
        <input type="text" id="newQuestion" style=" display: none" placeholder="Skriv svar här" name="newQuestion">
            </div>
        <div class="col-md-4">
        
    
   

        <p id="output"></p>
        
            </div>
        </div>
        </div>
    </body>
</html>


<script>
    
    var yesButton = document.getElementById('yesBtn');
    var noButton = document.getElementById('noBtn');
    var output = document.getElementById('output');
    var stringObject= document.getElementById("stringObject").innerText;
    var newQuestion = document.getElementById('newQuestion');
    var refresh = document.getElementById('refresh');
    var count=1
    var JsonObject = JSON.parse(stringObject)
    var saveToJson={};
    var currentObject={};
    var questioncount =0;
    
    var firstQuestion = findId(JsonObject,count);
    printQuestion(firstQuestion);
   

    yesButton.addEventListener("click", function(){
        count = count*=2;
        
        
        var foundObject = findId(JsonObject,count);
        

        if(foundObject==undefined){
            output.innerHTML += "<h4>" + "Datorn har gissat rätt" + "</h4>";
            document.getElementById('refresh').style.visibility = 'visible';
            }

        if(foundObject){
            currentObject = foundObject;
            if(foundObject.question){
                printQuestion(foundObject);
            }
            
        else if(foundObject.animal){
            printGuess(foundObject);
            }
        }
        
});

noButton.addEventListener("click", function(){
    
    count = count*2+1;

    var foundObject = findId(JsonObject,count);
    
   if(foundObject){
        currentObject = foundObject;
        if(foundObject.question){
            printQuestion(foundObject);
        }
        else if(foundObject.animal){
            printGuess(foundObject)
         }
    }
        if(foundObject == null){
            if(currentObject.animal){
               count = currentObject.id;
               currentObject.id = (count*2)+1;
                }
               
        if (newQuestion.style.display === "none") {
            newQuestion.style.display = "block";
    }
        console.log(JsonObject);
        output.innerHTML += "<p>Vad heter ditt djur?</p>";
        document.getElementById('submitAnswer').style.visibility = 'visible';
        document.getElementById("yesBtn").disabled = true;
        document.getElementById("noBtn").disabled = true;   
    }
});

    submitAnswer.addEventListener("click",function(){
        questioncount++;
        if(questioncount==1){
            if (newQuestion.value != "") {
                newQuestion = document.getElementById('newQuestion').value;
                saveToJson = {id:count*2,animal: newQuestion
                }
            output.innerText += newQuestion;
            document.getElementById("newQuestion").value = "";
            output.innerHTML += "<p>Vilken fråga skiljer djuren åt?</p>";
            pushToJson(saveToJson);
             }
         }
         
        if(questioncount==2){
            if (newQuestion != "") {
     
        newQuestion = document.getElementById('newQuestion').value;
        saveToJson = {id:count,question: newQuestion}
        output.innerText += newQuestion;
        newQuestion = document.getElementById('newQuestion');
        if (newQuestion.style.display === "block") {
            newQuestion.style.display = "none";}
            document.getElementById("yesBtn").disabled = false;
            document.getElementById("noBtn").disabled = false;
            pushToJson(saveToJson);
            UpdateJsonFile(JsonObject);
        }
    }
});



    function findId(JsonObject,count){
        return _.find(JsonObject,function(row){ return row.id == count });
    }

    function findChangeId(JsonObject){
        return _.find(JsonObject,function(row){ return row.id == currentObject.id });
        
    }
    function pushToJson(saveToJson){
        JsonObject.push(saveToJson)
}
    function UpdateJsonFile(JsonObject){
        var JsonString = JSON.stringify(JsonObject);
        var xhttp = new XMLHttpRequest();
        xhttp.open("POST","/", true),JSON;
        xhttp.send(JsonString);
        RefreshPage();
    }

    function RefreshPage(){
        location.reload();
    }
    function printQuestion(objectToPrint){
        output.innerHTML += "<p>" + objectToPrint.question + "</p>";
    }
    function printGuess(objectToPrint){
        output.innerHTML += "<p> Tänker du på " + objectToPrint.animal + "</p>";
    }
</script>

